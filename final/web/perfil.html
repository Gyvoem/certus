<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="index.css"> -->
    <title>Perfil</title>

    <style>
        [disabled] * {
            color: grey;
        }

        label {
            width: 100%;
            display: block;
        }

        form>label:first-of-type {
      display: none;
      /* importante */
    }
    </style>
    <script>
        if (sessionStorage.login.length > 3) {
            console.log("ok")
        } else {
            window.location.href = "sign.html";
        }
    </script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">GRUPO 7</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">

                <li class="nav-item">
                    <a class="nav-link" href="pokemones.html">Pokemones</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="favoritos.html">Favoritos</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="perfil.html">Perfil</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Cerrar sesion</a>
                </li>

            </ul>

        </div>
    </nav>
    <main>
        <div class="titulo">
            Bienvenido a tu perfil
        </div>
        <br><br>
        <p id="panel" size="20" onclick="panelClick()"></p>
        <button class="btn btn-warning" onclick="editarClick()">Editar</button>

        <br><br>
        <fieldset disabled>
            <form onsubmit="event.preventDefault()">

                <button class="btn btn-success" onclick="update()">Guardar</button><br><br>
                <button class="btn btn-danger" onclick="eliminar()">Eliminar Cuenta</button>
                <br /><br />
            </form>
        </fieldset>
        
    </main>

    <script>
        let el, i;
        let data = [];


        obtenerPerfil()
        function obtenerPerfil() {
      fetch("http://localhost:9000/api/users/" + sessionStorage.login, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(res => res.json())
        .then((data) => {
          console.log(data)

          for (const i in data) {
            console.log(i, data[i], data[3])


            let campo = document.createElement('input');
            campo.value = data[i];
            campo.id = i;
            let label = document.createElement('label');
            label.innerHTML = i;
            label.append(campo)
            let formPrimerBtn = document.querySelector('form button:first-of-type')
            let form = document.querySelector('form')

            //inserta losinputs antes del primer btn
            form.insertBefore(label, formPrimerBtn)

          }
        })
        .catch(error => console.error('Error:', error))
    }



    

        function update() {

            let allInputs = document.querySelectorAll('form input');

            allInputs.forEach(input => {
            console.log(input.value)
            })

            nombre = document.getElementById('nombre').value;
            correo = document.getElementById('correo').value;
            usuario = document.getElementById('usuario').value;
            contraseña = document.getElementById('contraseña').value;

            fetch("http://localhost:9000/api/users/" + sessionStorage.login, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "nombre": nombre, "correo": correo, "usuario": usuario, "contraseña": contraseña })
            }).then(res => res.json())
            .then((data) => {
                console.log(data)


                /* 
                        nombre = document.getElementById('nombre').value;
                        data = { nombre: nombre, correo: correo, usuario: usuario, contraseña: contraseña }
                
                        console.log(nombre, data) */

            })
            .catch(error => console.error('Error:', error))
        }

        function eliminar() {
            const rpta = confirm("Desea eliminar la cuenta?");
            if (rpta) {
                fetch("http://localhost:9000/api/users/" + sessionStorage.login, {
                    method: 'DELETE',
                    headers: new Headers({ 'Content-Type': 'application/json' }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.deletedCount == 1) {
                            alert('Usuario eliminado');
                            window.location.href = "sign.html";
                        } else {
                            alert("No se pudo eliminar usuario")
                        }
                    });
            }
            
        }

        function editarClick() {


            let fieldset = document.querySelector('fieldset');

            fieldset.hasAttribute('disabled') ? fieldset.removeAttribute('disabled') : fieldset.setAttribute('disabled', '')




            // document.querySelector("#fname").value = data[0].firstname;
            // document.querySelector("#lname").value = data[0].lastname;
        }

    // renderItem();
    </script>
</body>

</html>